#
# Compose is a tool for defining and running multi-container Dockerized applications.
#

version: '2'

networks:
  # Database management network
  internal-api:

services:
  #
  # Firebase Cloud Messaging (FCM) App Server
  #
  fcm-app-server:
    build:
      context: ./fcm-app-server
    networks:
        internal-api:
          aliases:
            - fcm-app-server
    working_dir: /src/gcm-playground/server/
    command: go run server.go

  #
  # DD-WRT Notifier service: connects to ftp://dd-wrt.com/betas and 
  # checks for new updates.
  # If any, it POSTs a new message to the fcm-app-server service above, 
  # so the latter can push it to FCM for 
  # notifications on end-user devices
  #
  dd-wrt-notifier:
    build:
      context: ./dd-wrt-notifier
    volumes:
      - /tmp
      - /data
    networks:
      - internal-api
    working_dir: /code/
    command: /usr/sbin/crond -l 2 -f
